<%= error_messages_for "job" %>

<h2><%= @project.name %></h2>

<table><tr>
	<td><%= button_to "Rename", {:action => "edit_project", :id => @project.id} %></td>
	<td><%= button_to "Delete", {:action => "delete_project", :id => @project.id}, :confirm => "Are you sure you want to delete #{h(@project.name)}?" %></td>
	<td><%= button_to "Back to projects", :controller => "supramap", :action => "projects" %></td>
</tr></table>

<fieldset id="files">
	<legend>Files</legend>
	<table>
		<% unless @sfiles.size == 0 %>
		<tr>
			<th>Name</th>
			<th>Uploaded at</th>
			<th>Actions</th>
			<th>Kind</th>
			<!--<th>Size</th>-->
		</tr>
		<% else %>
			<p>No files have been uploaded to this project.</p>
		<% end %>
		<% for sfile in @sfiles %>
			<tr>
				<td><a href="/files/<%= sfile.project.user.login %>/<%= sfile.project_id %>/<%= sfile.filename %>" title="Download File"><%= sfile.filename %></a></td>
				<td><%= sfile.created_at.to_date %></td>
				<td><%= button_to "Delete", {:action => "delete_file", :id => sfile.id}, :confirm => "Are you sure you want to delete file #{h(sfile.filename)}?" %></td>
				<td><%= sfile.filetype %></td>
			</tr>
		<% end %>
	</table>
	
	<%= button_to "Add file", {:action => "add_file", :id => @project.id} %>
	
</fieldset>

<fieldset id="jobs">
	<legend>Jobs</legend>
	<table>
		<% unless @jobs.size == 0 %>
		<tr>
			<th>Name</th>
			<th>Started at</th>
			<th>Status</th>
			<th colspan="4">Action</th>
		</tr>
		<% else %>
			<p>No jobs defined for this project.</p>
		<% end %>
		<% for job in @jobs %>
			<tr>
				<td><%= h(job.name) %></td>
				<td class="started_at"><%= job.created_at.to_time.to_s(:db) %></td>
				<td class="status"><%= job.status %></td>
				
				<% if job.status == "Running" %>
				<td><%= button_to "Stop", {:action => "stop_job", :id => job.id}, :confirm => "Are you sure that you want to stop job #{h(job.name)}?"%></td>
				<% end %>
				
				<% if job.status == "Stopped" %>
				<td><%= button_to "Delete", {:action => "delete_job", :id => job.id}, :confirm => "Are you sure you want to delete job #{h(job.name)} and associated results?" %></td>
				<% end %>
				<% if job.status == "Completed" %>
				<td><%= button_to "Delete", {:action => "delete_job", :id => job.id}, :confirm => "Are you sure you want to delete job #{h(job.name)} and associated results?" %></td>
				<% end %>
			</tr>
			<% job.sfiles.each do |file| %>
			<tr>
				<td>&nbsp;</td>
				<td colspan="6" class="job_files"><%= file.filename %></td>
			</tr>
			<% end %>
		<% end%>
	</table>
	
	<% form_for :job, @job, :url => {:action => "add_job"} do |form| %>
		<table><tr>
			<td>New job</td>
			<td><%= form.text_field :name, :size => 20 %></td>
			<input type="hidden" id="user_id" name="job[project_id]" value="<%= @project.id %>" />
			<td><%= submit_tag "Define", :class => "submit" %></td>
		</tr></table>
	<% end%>
</fieldset>

<fieldset>
	<legend>Results</legend>  
	<table>
		<tr>
			<th>Name</th>
			<th colspan="3">Download</th>
			<!-- <th>Query</th>-->
		</tr>
	<% @jobs.each do |job|
		if job.status == "Completed" %>
		<tr>
			<td><%= job.name %></td>
			<td><%= link_to "KML",  "/files/#{job.project.user.login}/#{job.project_id}/#{job.id}/kml_#{job.id}.kml"%></td>
			<!-- Need to update with appropriate locations -->
			<td><%= link_to "Tree",  " /files/#{job.project.user.login}/#{job.project_id}/#{job.id}/results_#{job.id}.tre"%></td>
			<td><%= link_to "Stats",  "/files/#{job.project.user.login}/#{job.project_id}/#{job.id}/results_#{job.id}.stats"%></td>
			<td><%=  %></td>
			<!-- button_to "Run", {:action => "view_table", :job_id => job.id} -->
		</tr>
		<% end
	end %>
	</table>
</fieldset>
